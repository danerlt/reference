<!doctype html>
<html lang="en" data-color-mode="dark">
<head>
<meta charset="utf-8">
<title>---
title: Mitmproxy
date: 2020-12-22 20:10:08
icon: icon-mitmproxy
background: bg-[#d86138]
tags:
    - capture
    - traffic
    - network
    - utility
categories:
    - Toolkit
intro: |
    [mitmproxy](https://mitmproxy.org/) is a free and open source interactive HTTPS proxy. This is a quick reference cheat sheet to the mitmproxy.
---

Getting started {.cols-3}
---------------

### Usage {.col-span-2}
| Option | Example                                            | Description                               |
|--------|----------------------------------------------------|-------------------------------------------|
| `-p`   | mitmproxy -p 8001                                  | Start proxy on port 8001                  |
| `-m`   | mitmproxy -p 8001 -m reverse:http://127.0.0.1:4000 | Reverse proxy on port 8001 to port 4000   |
| `-w`   | mitmproxy -p 8001 -w traffic.mitm                  | Stream flows to file as they arrive       |
| `-r`   | mitmproxy -r traffic.mitm                          | Read flows from file                      |
| `-C`   | mitmproxy -C traffic.mitm                          | Replay client requests from a saved file  |
| `-S`   | mitmproxy -S traffic.mitm                          | Replay server responses from a saved file |
| `-s`   | mitmproxy -s myScript.py                           | Execute a script                          |
| `-h`   | mitmproxy -h                                       | mitmproxy quick help                      |


### Movement 
```markdown
        k                 Ctrl b
        ▲                   ▲▲
        │                   ││
h ◀ ─── + ─── ▶ l           ││ page
        │                   ││
        ▼                   ▼▼
        j             Ctrl f / Space 
```
---

| -                    | -                     |
|----------------------|-----------------------|
| `h`, `j`, `k` ,`l`   | Left, Down, Up, Right |
| `Ctrl` `b`           | Page up               |
| `Space` / `Ctrl` `f` | Page down             |
| `g` / `G`            | Go to beginning / end |
| `Arrows`             | Up, Down, Left, Right |
{.shortcuts}




### Common Keybindings
| -       | -                |
|---------|------------------|
| `q`     | Back / Exit      |
| `z`     | Clear flow list  |
| `:`     | Command prompt   |
| `E`     | View event log   |
| `O`     | View options     |
| `r`     | Replay this flow |
| `Tab`   | Next             |
| `Enter` | Select           |
{.shortcuts}



### Global Keybindings
| -              | -                         |
|----------------|---------------------------|
| `-`            | Cycle to next layout      |
| `?`            | View help                 |
| `B`            | Start an attached browser |
| `C`            | View commands             |
| `I`            | Toggle intercept          |
| `K`            | View key bindings         |
| `P`            | View flow details         |
| `Q`            | Exit immediately          |
| `W`            | Stream to file            |
| `i`            | Set intercept             |
| `Ctrl` `right` | Focus next layout pane    |
| `Shift` `tab`  | Focus next layout pane    |
{.shortcuts}






### Flow (View)
| -          | -                            |
|------------|------------------------------|
| `A`        | Resume all intercepted flows |
| `D`        | Duplicate flow               |
| `F`        | Set focus follow             |
| `L`        | Load flows from file         |
| `M`        | Toggle viewing marked flows  |
| `S`        | Start server replay          |
| `U`        | Un-set all marks             |
| `V`        | Revert changes to this flow  |
| `X`        | Kill this flow               |
| `Z`        | Purge all flows not showing  |
| `a`        | Resume this intercepted flow |
| `b`        | Save response body to file   |
| `d`        | Delete flow from view        |
| `e`        | Export this flow to file     |
| `f`        | Set view filter              |
| `m`        | Toggle mark on this flow     |
| `n`        | Create a new flow            |
| `o`        | Set flow list order          |
| `r`        | Replay this flow             |
| `v`        | Reverse flow list order      |
| `w`        | Save listed flows to file    |
| `|`        | Run a script on this flow    |
| `Ctrl` `l` | Send cuts to clipboard       |

{.shortcuts}




Mitmproxy Filter {.cols-3}
---------------

### Filter
| -   | -                                     |
|-----|---------------------------------------|
| `f` | Set view filter _(on flow view page)_ |
{.shortcuts}

---

- [RegEX cheatsheet](/regex) _(quickref.me)_

The regex are Python-style, it can be specified as quoted strings



### Operators

| -       | -         |
|---------|-----------|
| `!`     | unary not |
| `&#x26;`     | and       |
| `|`     | or        |
| `(...)` | grouping  |


### Expressions {.row-span-2}

| -              | -                                                          |
|----------------|------------------------------------------------------------|
| `~a`           | Match asset in response: CSS, Javascript, Flash, images.   |
| `~b` `regex`   | Body                                                       |
| `~bq` `regex`  | Request body                                               |
| `~bs` `regex`  | Response body                                              |
| `~c` `int`     | HTTP response code                                         |
| `~d` `regex`   | Domain                                                     |
| `~dst` `regex` | Match destination address                                  |
| `~e`           | Match error                                                |
| `~h` `regex`   | Header                                                     |
| `~hq` `regex`  | Request header                                             |
| `~hs` `regex`  | Response header                                            |
| `~http`        | Match HTTP flows                                           |
| `~m` `regex`   | Method                                                     |
| `~marked`      | Match marked flows                                         |
| `~q`           | Match request with no response                             |
| `~s`           | Match response                                             |
| `~src` `regex` | Match source address                                       |
| `~t` `regex`   | Content-type header                                        |
| `~tcp`         | Match TCP flows                                            |
| `~tq` `regex`  | Request Content-Type header                                |
| `~ts` `regex`  | Response Content-Type header                               |
| `~u` `regex`   | URL                                                        |
| `~websocket`   | Match WebSocket flows (and HTTP-WebSocket handshake flows) |

### Flow selectors
Expressions
| -           | -                          |
|-------------|----------------------------|
| `@all     ` | All flows                  |
| `@focus   ` | The currently focused flow |
| `@shown   ` | All flows currently shown  |
| `@hidden  ` | All flows currently hidden |
| `@marked  ` | All marked flows           |
| `@unmarked` | All unmarked flows         |

mitmproxy has a set of convenient flow selectors that operate on the current view



### Examples
URL containing "google.com"

```
google\.com
```

Requests whose body contains the string "test"
```
~q ~b test
```

Anything but requests with a text/html content type:
```
!(~q &#x26; ~t "text/html")
```

Replace entire GET string in a request (quotes required to make it work):
```
":~q ~m GET:.*:/replacement.html"
```






Mitmproxy Scripts  {.cols-2}
-------


### Custom response

```python
from mitmproxy import http


def request(flow: http.HTTPFlow) -> None:
    if flow.request.pretty_url  &#x26;  mitmproxy cheatsheet &#x26;  Quick Reference</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta description="为开发人员分享快速参考备忘单。">
<meta keywords="Quick,Reference,cheatsheet,mitmproxy">
<link rel="stylesheet" href="style/style.css">
</head>
<body><nav class="header-nav"><div class="max-container"><a href="index.html" class="logo"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" height="1em" width="1em"><path opacity=".5" d="m21.66 10.44-.98 4.18c-.84 3.61-2.5 5.07-5.62 4.77-.5-.04-1.04-.13-1.62-.27l-1.68-.4c-4.17-.99-5.46-3.05-4.48-7.23l.98-4.19c.2-.85.44-1.59.74-2.2 1.17-2.42 3.16-3.07 6.5-2.28l1.67.39c4.19.98 5.47 3.05 4.49 7.23Z" fill="white"></path><path d="M15.06 19.39c-.62.42-1.4.77-2.35 1.08l-1.58.52c-3.97 1.28-6.06.21-7.35-3.76L2.5 13.28c-1.28-3.97-.22-6.07 3.75-7.35l1.58-.52c.41-.13.8-.24 1.17-.31-.3.61-.54 1.35-.74 2.2l-.98 4.19c-.98 4.18.31 6.24 4.48 7.23l1.68.4c.58.14 1.12.23 1.62.27Zm2.43-8.88c-.06 0-.12-.01-.19-.02l-4.85-1.23a.75.75 0 0 1 .37-1.45l4.85 1.23a.748.748 0 0 1-.18 1.47Z" fill="#cbd5e1"></path><path d="M14.56 13.89c-.06 0-.12-.01-.19-.02l-2.91-.74a.75.75 0 0 1 .37-1.45l2.91.74c.4.1.64.51.54.91-.08.34-.38.56-.72.56Z" fill="#292D32"></path></svg><span class="title">Quick Reference</span></a><div class="menu"><a href="https://github.com/danerlt/reference/blob/main/mitmproxy.md" class="" target="__blank"><svg viewBox="0 0 36 36" fill="currentColor" height="1em" width="1em"><path d="m33 6.4-3.7-3.7a1.71 1.71 0 0 0-2.36 0L23.65 6H6a2 2 0 0 0-2 2v22a2 2 0 0 0 2 2h22a2 2 0 0 0 2-2V11.76l3-3a1.67 1.67 0 0 0 0-2.36ZM18.83 20.13l-4.19.93 1-4.15 9.55-9.57 3.23 3.23ZM29.5 9.43 26.27 6.2l1.85-1.85 3.23 3.23Z"></path><path fill="none" d="M0 0h36v36H0z"></path></svg><span>编辑</span></a><a href="https://github.com/jaywcjlove/reference" class="" target="__blank"><svg viewBox="0 0 16 16" fill="currentColor" height="1em" width="1em"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a></div></div></nav><div class="wrap"><div class="wrap-header h2wrap"><h2>
  title: Mitmproxy
  date: 2020-12-22 20:10:08
  icon: icon-mitmproxy
  background: bg-[#d86138]
  tags:
  - capture
  - traffic
  - network
  - utility
  categories:
  - Toolkit
  intro: |
  <a href="https://mitmproxy.org/">mitmproxy</a> is a free and open source interactive HTTPS proxy. This is a quick reference cheat sheet to the mitmproxy.
</h2><div class="wrap-body">
</div></div></div><div class="wrap"><div class="wrap-header h2wrap"><h2>Getting started {.cols-3}</h2><div class="wrap-body">
</div></div><div class="h2wrap-body"><div class="wrap"><div class="wrap-header h3wrap"><h3>Usage {.col-span-2}</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Example</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>-p</code></td>
      <td>mitmproxy -p 8001</td>
      <td>Start proxy on port 8001</td>
    </tr>
    <tr>
      <td><code>-m</code></td>
      <td>mitmproxy -p 8001 -m reverse:<a href="http://127.0.0.1:4000">http://127.0.0.1:4000</a></td>
      <td>Reverse proxy on port 8001 to port 4000</td>
    </tr>
    <tr>
      <td><code>-w</code></td>
      <td>mitmproxy -p 8001 -w traffic.mitm</td>
      <td>Stream flows to file as they arrive</td>
    </tr>
    <tr>
      <td><code>-r</code></td>
      <td>mitmproxy -r traffic.mitm</td>
      <td>Read flows from file</td>
    </tr>
    <tr>
      <td><code>-C</code></td>
      <td>mitmproxy -C traffic.mitm</td>
      <td>Replay client requests from a saved file</td>
    </tr>
    <tr>
      <td><code>-S</code></td>
      <td>mitmproxy -S traffic.mitm</td>
      <td>Replay server responses from a saved file</td>
    </tr>
    <tr>
      <td><code>-s</code></td>
      <td>mitmproxy -s myScript.py</td>
      <td>Execute a script</td>
    </tr>
    <tr>
      <td><code>-h</code></td>
      <td>mitmproxy -h</td>
      <td>mitmproxy quick help</td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Movement</h3><div class="wrap-body">
<pre class="language-markdown"><code class="language-markdown code-highlight"><span class="code-line line-number" line="1">        k                 Ctrl b
</span><span class="code-line line-number" line="2">        ▲                   ▲▲
</span><span class="code-line line-number" line="3">        │                   ││
</span><span class="code-line line-number" line="4">h ◀ ─── + ─── ▶ l           ││ page
</span><span class="code-line line-number" line="5">        │                   ││
</span><span class="code-line line-number" line="6">        ▼                   ▼▼
</span><span class="code-line line-number" line="7">        j             Ctrl f / Space 
</span></code></pre>
<hr>
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>h</code>, <code>j</code>, <code>k</code> ,<code>l</code></td>
      <td>Left, Down, Up, Right</td>
    </tr>
    <tr>
      <td><code>Ctrl</code> <code>b</code></td>
      <td>Page up</td>
    </tr>
    <tr>
      <td><code>Space</code> / <code>Ctrl</code> <code>f</code></td>
      <td>Page down</td>
    </tr>
    <tr>
      <td><code>g</code> / <code>G</code></td>
      <td>Go to beginning / end</td>
    </tr>
    <tr>
      <td><code>Arrows</code></td>
      <td>Up, Down, Left, Right</td>
    </tr>
    <tr>
      <td>{.shortcuts}</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Common Keybindings</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>q</code></td>
      <td>Back / Exit</td>
    </tr>
    <tr>
      <td><code>z</code></td>
      <td>Clear flow list</td>
    </tr>
    <tr>
      <td><code>:</code></td>
      <td>Command prompt</td>
    </tr>
    <tr>
      <td><code>E</code></td>
      <td>View event log</td>
    </tr>
    <tr>
      <td><code>O</code></td>
      <td>View options</td>
    </tr>
    <tr>
      <td><code>r</code></td>
      <td>Replay this flow</td>
    </tr>
    <tr>
      <td><code>Tab</code></td>
      <td>Next</td>
    </tr>
    <tr>
      <td><code>Enter</code></td>
      <td>Select</td>
    </tr>
    <tr>
      <td>{.shortcuts}</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Global Keybindings</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>-</code></td>
      <td>Cycle to next layout</td>
    </tr>
    <tr>
      <td><code>?</code></td>
      <td>View help</td>
    </tr>
    <tr>
      <td><code>B</code></td>
      <td>Start an attached browser</td>
    </tr>
    <tr>
      <td><code>C</code></td>
      <td>View commands</td>
    </tr>
    <tr>
      <td><code>I</code></td>
      <td>Toggle intercept</td>
    </tr>
    <tr>
      <td><code>K</code></td>
      <td>View key bindings</td>
    </tr>
    <tr>
      <td><code>P</code></td>
      <td>View flow details</td>
    </tr>
    <tr>
      <td><code>Q</code></td>
      <td>Exit immediately</td>
    </tr>
    <tr>
      <td><code>W</code></td>
      <td>Stream to file</td>
    </tr>
    <tr>
      <td><code>i</code></td>
      <td>Set intercept</td>
    </tr>
    <tr>
      <td><code>Ctrl</code> <code>right</code></td>
      <td>Focus next layout pane</td>
    </tr>
    <tr>
      <td><code>Shift</code> <code>tab</code></td>
      <td>Focus next layout pane</td>
    </tr>
    <tr>
      <td>{.shortcuts}</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Flow (View)</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>A</code></td>
      <td>Resume all intercepted flows</td>
    </tr>
    <tr>
      <td><code>D</code></td>
      <td>Duplicate flow</td>
    </tr>
    <tr>
      <td><code>F</code></td>
      <td>Set focus follow</td>
    </tr>
    <tr>
      <td><code>L</code></td>
      <td>Load flows from file</td>
    </tr>
    <tr>
      <td><code>M</code></td>
      <td>Toggle viewing marked flows</td>
    </tr>
    <tr>
      <td><code>S</code></td>
      <td>Start server replay</td>
    </tr>
    <tr>
      <td><code>U</code></td>
      <td>Un-set all marks</td>
    </tr>
    <tr>
      <td><code>V</code></td>
      <td>Revert changes to this flow</td>
    </tr>
    <tr>
      <td><code>X</code></td>
      <td>Kill this flow</td>
    </tr>
    <tr>
      <td><code>Z</code></td>
      <td>Purge all flows not showing</td>
    </tr>
    <tr>
      <td><code>a</code></td>
      <td>Resume this intercepted flow</td>
    </tr>
    <tr>
      <td><code>b</code></td>
      <td>Save response body to file</td>
    </tr>
    <tr>
      <td><code>d</code></td>
      <td>Delete flow from view</td>
    </tr>
    <tr>
      <td><code>e</code></td>
      <td>Export this flow to file</td>
    </tr>
    <tr>
      <td><code>f</code></td>
      <td>Set view filter</td>
    </tr>
    <tr>
      <td><code>m</code></td>
      <td>Toggle mark on this flow</td>
    </tr>
    <tr>
      <td><code>n</code></td>
      <td>Create a new flow</td>
    </tr>
    <tr>
      <td><code>o</code></td>
      <td>Set flow list order</td>
    </tr>
    <tr>
      <td><code>r</code></td>
      <td>Replay this flow</td>
    </tr>
    <tr>
      <td><code>v</code></td>
      <td>Reverse flow list order</td>
    </tr>
    <tr>
      <td><code>w</code></td>
      <td>Save listed flows to file</td>
    </tr>
    <tr>
      <td>`</td>
      <td>`</td>
    </tr>
    <tr>
      <td><code>Ctrl</code> <code>l</code></td>
      <td>Send cuts to clipboard</td>
    </tr>
  </tbody>
</table>
<p>{.shortcuts}</p>
</div></div></div></div></div><div class="wrap"><div class="wrap-header h2wrap"><h2>Mitmproxy Filter {.cols-3}</h2><div class="wrap-body">
</div></div><div class="h2wrap-body"><div class="wrap"><div class="wrap-header h3wrap"><h3>Filter</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>f</code></td>
      <td>Set view filter <em>(on flow view page)</em></td>
    </tr>
    <tr>
      <td>{.shortcuts}</td>
      <td></td>
    </tr>
  </tbody>
</table>
<hr>
<ul>
  <li><a href="/regex">RegEX cheatsheet</a> <em>(quickref.me)</em></li>
</ul>
<p>The regex are Python-style, it can be specified as quoted strings</p>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Operators</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>!</code></td>
      <td>unary not</td>
    </tr>
    <tr>
      <td><code>&#x26;</code></td>
      <td>and</td>
    </tr>
    <tr>
      <td>`</td>
      <td>`</td>
    </tr>
    <tr>
      <td><code>(...)</code></td>
      <td>grouping</td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Expressions {.row-span-2}</h3><div class="wrap-body">
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>~a</code></td>
      <td>Match asset in response: CSS, Javascript, Flash, images.</td>
    </tr>
    <tr>
      <td><code>~b</code> <code>regex</code></td>
      <td>Body</td>
    </tr>
    <tr>
      <td><code>~bq</code> <code>regex</code></td>
      <td>Request body</td>
    </tr>
    <tr>
      <td><code>~bs</code> <code>regex</code></td>
      <td>Response body</td>
    </tr>
    <tr>
      <td><code>~c</code> <code>int</code></td>
      <td>HTTP response code</td>
    </tr>
    <tr>
      <td><code>~d</code> <code>regex</code></td>
      <td>Domain</td>
    </tr>
    <tr>
      <td><code>~dst</code> <code>regex</code></td>
      <td>Match destination address</td>
    </tr>
    <tr>
      <td><code>~e</code></td>
      <td>Match error</td>
    </tr>
    <tr>
      <td><code>~h</code> <code>regex</code></td>
      <td>Header</td>
    </tr>
    <tr>
      <td><code>~hq</code> <code>regex</code></td>
      <td>Request header</td>
    </tr>
    <tr>
      <td><code>~hs</code> <code>regex</code></td>
      <td>Response header</td>
    </tr>
    <tr>
      <td><code>~http</code></td>
      <td>Match HTTP flows</td>
    </tr>
    <tr>
      <td><code>~m</code> <code>regex</code></td>
      <td>Method</td>
    </tr>
    <tr>
      <td><code>~marked</code></td>
      <td>Match marked flows</td>
    </tr>
    <tr>
      <td><code>~q</code></td>
      <td>Match request with no response</td>
    </tr>
    <tr>
      <td><code>~s</code></td>
      <td>Match response</td>
    </tr>
    <tr>
      <td><code>~src</code> <code>regex</code></td>
      <td>Match source address</td>
    </tr>
    <tr>
      <td><code>~t</code> <code>regex</code></td>
      <td>Content-type header</td>
    </tr>
    <tr>
      <td><code>~tcp</code></td>
      <td>Match TCP flows</td>
    </tr>
    <tr>
      <td><code>~tq</code> <code>regex</code></td>
      <td>Request Content-Type header</td>
    </tr>
    <tr>
      <td><code>~ts</code> <code>regex</code></td>
      <td>Response Content-Type header</td>
    </tr>
    <tr>
      <td><code>~u</code> <code>regex</code></td>
      <td>URL</td>
    </tr>
    <tr>
      <td><code>~websocket</code></td>
      <td>Match WebSocket flows (and HTTP-WebSocket handshake flows)</td>
    </tr>
  </tbody>
</table>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Flow selectors</h3><div class="wrap-body">
<p>Expressions</p>
<table>
  <thead>
    <tr>
      <th>-</th>
      <th>-</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>@all</code></td>
      <td>All flows</td>
    </tr>
    <tr>
      <td><code>@focus</code></td>
      <td>The currently focused flow</td>
    </tr>
    <tr>
      <td><code>@shown</code></td>
      <td>All flows currently shown</td>
    </tr>
    <tr>
      <td><code>@hidden</code></td>
      <td>All flows currently hidden</td>
    </tr>
    <tr>
      <td><code>@marked</code></td>
      <td>All marked flows</td>
    </tr>
    <tr>
      <td><code>@unmarked</code></td>
      <td>All unmarked flows</td>
    </tr>
  </tbody>
</table>
<p>mitmproxy has a set of convenient flow selectors that operate on the current view</p>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Examples</h3><div class="wrap-body">
<p>URL containing "google.com"</p>
<pre><code class="code-highlight"><span class="code-line line-number" line="1">google\.com
</span></code></pre>
<p>Requests whose body contains the string "test"</p>
<pre><code class="code-highlight"><span class="code-line line-number" line="1">~q ~b test
</span></code></pre>
<p>Anything but requests with a text/html content type:</p>
<pre><code class="code-highlight"><span class="code-line line-number" line="1">!(~q &#x26; ~t "text/html")
</span></code></pre>
<p>Replace entire GET string in a request (quotes required to make it work):</p>
<pre><code class="code-highlight"><span class="code-line line-number" line="1">":~q ~m GET:.*:/replacement.html"
</span></code></pre>
</div></div></div></div></div><div class="wrap"><div class="wrap-header h2wrap"><h2>Mitmproxy Scripts {.cols-2}</h2><div class="wrap-body">
</div></div><div class="h2wrap-body"><div class="wrap"><div class="wrap-header h3wrap"><h3>Custom response</h3><div class="wrap-body">
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">from</span> mitmproxy <span class="token keyword">import</span> http
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>flow<span class="token punctuation">:</span> http<span class="token punctuation">.</span>HTTPFlow<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">if</span> flow<span class="token punctuation">.</span>request<span class="token punctuation">.</span>pretty_url <span class="token operator">==</span> <span class="token string">"http://example.com/path"</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">        flow<span class="token punctuation">.</span>response <span class="token operator">=</span> http<span class="token punctuation">.</span>HTTPResponse<span class="token punctuation">.</span>make<span class="token punctuation">(</span>
</span><span class="code-line line-number" line="7">            <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment"># (optional) status code</span>
</span><span class="code-line line-number" line="8">            <span class="token string">b"Hello World"</span><span class="token punctuation">,</span>  <span class="token comment"># (optional) content</span>
</span><span class="code-line line-number" line="9">            <span class="token punctuation">{</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"text/html"</span><span class="token punctuation">}</span>  <span class="token comment"># (optional) headers</span>
</span><span class="code-line line-number" line="10">        <span class="token punctuation">)</span>
</span></code></pre>
<p>Send a reply from the proxy without sending any data to the remote server</p>
</div></div></div><div class="wrap"><div class="wrap-header h3wrap"><h3>Add header</h3><div class="wrap-body">
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">class</span> <span class="token class-name">AddHeader</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="2">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="3">        self<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token keyword">def</span> <span class="token function">response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> flow<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line line-number" line="6">        self<span class="token punctuation">.</span>num <span class="token operator">=</span> self<span class="token punctuation">.</span>num <span class="token operator">+</span> <span class="token number">1</span>
</span><span class="code-line line-number" line="7">        flow<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"count"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">addons <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line line-number" line="11">    AddHeader<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12"><span class="token punctuation">]</span>
</span></code></pre>
<p>Add an HTTP header to each response</p>
</div></div></div></div></div><div class="wrap"><div class="wrap-header h2wrap"><h2>Also see</h2><div class="wrap-body">
<ul>
  <li><a href="https://github.com/mitmproxy/mitmproxy/tree/master/examples/addons">mitmproxy addons</a> <em>(github.com)</em></li>
  <li><a href="https://docs.mitmproxy.org/">mitmproxy docs</a> <em>(mitmproxy.org)</em></li>
</ul>

</div></div></div><footer class="footer-wrap"><footer class="max-container">© 2022 Kenny Wang, All rights reserved.</footer></footer></body>
</html>
